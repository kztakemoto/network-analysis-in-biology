library(igraph)
# エッジリストの読み込み
d <- read.table("../data/ecoli_ppi_Hu_etal_2009.txt")
# グラフオブジェクトの作成
g <- simplify(graph.data.frame(d,directed=F),remove.multiple=T,remove.loops=T)
# 最大連結成分の取得
cls <- clusters(g,"weak")
g <- delete.vertices(g,subset(V(g),cls$membership!=which(cls$csize==max(cls$csize))[[1]]))
# 次数中心性（degree centrality）
degree <- degree(g)
# 固有ベクトル中心性（eigenvector centraliry）
eigen <- evcent(g)$vector
# PageRank
page <- page.rank(g)$vector
# 近接中心性（closeness centrality）
closen <- closeness(g)
# 媒介中心性（betweenness centrality）
between <- betweenness(g)
# サブグラフ中心性（subgraph centrality）
subgraph <- subgraph.centrality(g)
# データフレームにまとめる
nprop <- data.frame(V(g)$name,degree,eigen,page,closen,between,subgraph)
names(nprop)[[1]] <- "gene"
ess <- read.table("../data/ecoli_proteins_essentiality_Baba2006MSB.txt",header=T)
# 必須（E），非必須（N），不明（u）
# 中心性指標のデータと必須性のデータをマージする
d <- merge(ess, nprop,by="gene")
# unknownの遺伝子を除外する。
d <- d[d$essential!="u",]
# 必須タンパク質の中心性指標
ess_nprop <- d[d$essential=="E",]
# 非必須タンパク質の中心性指標
noness_nprop <- d[d$essential=="N",]
cat("次数中心性（degree centrality）
中央値　必須：",median(ess_nprop$degree),"非必須：",median(noness_nprop$degree),"\n")
wilcox.test(ess_nprop$degree,noness_nprop$degree)
# 必須なら1，非必須なら0とする。
ess_score <- ifelse(d$essential == "E",1,0)
# ROCカーブを書くためのパッケージを読み込む
library(pROC)
layout(matrix(1:6, ncol=3))
# 次数中心性（degree centrality）
plot.roc(ess_score,d$degree,print.auc=T,main="Degree")
# 固有ベクトル中心性（eigenvector centraliry）
plot.roc(ess_score,d$eigen,print.auc=T,main="Eigenvector")
# PageRank
plot.roc(ess_score,d$page,print.auc=T,main="PageRank")
# 近接中心性（closeness centrality）
plot.roc(ess_score,d$closen,print.auc=T,main="Closeness")
# 媒介中心性（betweenness centrality）
plot.roc(ess_score,d$between,print.auc=T,main="Betweenness")
# サブグラフ中心性（Subgraph centrality）
plot.roc(ess_score,d$subgraph,print.auc=T,main="Subgraph")
layout(matrix(1:6, ncol=3))
# 次数中心性（degree centrality）
plot.roc(ess_score,d$degree,print.auc=T,main="Degree")
# 固有ベクトル中心性（eigenvector centraliry）
plot.roc(ess_score,d$eigen,print.auc=T,main="Eigenvector")
# PageRank
plot.roc(ess_score,d$page,print.auc=T,main="PageRank")
# 近接中心性（closeness centrality）
plot.roc(ess_score,d$closen,print.auc=T,main="Closeness")
# 媒介中心性（betweenness centrality）
plot.roc(ess_score,d$between,print.auc=T,main="Betweenness")
# サブグラフ中心性（Subgraph centrality）
plot.roc(ess_score,d$subgraph,print.auc=T,main="Subgraph")
cat("固有ベクトル中心性（eigenvector centraliry）
中央値　必須：",median(ess_nprop$eigen),"非必須：",median(noness_nprop$eigen),"\n")
wilcox.test(ess_nprop$eigen,noness_nprop$eigen)
cat("PageRank
中央値　必須：",median(ess_nprop$page),"非必須：",median(noness_nprop$page),"\n")
wilcox.test(ess_nprop$page,noness_nprop$page)
cat("近接中心性（closeness centrality）
中央値　必須：",median(ess_nprop$closen),"非必須：",median(noness_nprop$closen),"\n")
wilcox.test(ess_nprop$closen,noness_nprop$closen)
cat("媒介中心性（betweenness centrality）
中央値　必須：",median(ess_nprop$between),"非必須：",median(noness_nprop$between),"\n")
wilcox.test(ess_nprop$between,noness_nprop$between)
cat("サブグラフ中心性（subgraph centrality）
中央値　必須：",median(ess_nprop$subgraph),"非必須：",median(noness_nprop$subgraph),"\n")
wilcox.test(ess_nprop$subgraph,noness_nprop$subgraph)
cat("次数中心性（degree centrality）
中央値　必須：",median(ess_nprop$degree),"非必須：",median(noness_nprop$degree),"\n")
wilcox.test(ess_nprop$degree,noness_nprop$degree)
cat("固有ベクトル中心性（eigenvector centraliry）
中央値　必須：",median(ess_nprop$eigen),"非必須：",median(noness_nprop$eigen),"\n")
wilcox.test(ess_nprop$eigen,noness_nprop$eigen)
cat("PageRank
中央値　必須：",median(ess_nprop$page),"非必須：",median(noness_nprop$page),"\n")
wilcox.test(ess_nprop$page,noness_nprop$page)
cat("近接中心性（closeness centrality）
中央値　必須：",median(ess_nprop$closen),"非必須：",median(noness_nprop$closen),"\n")
wilcox.test(ess_nprop$closen,noness_nprop$closen)
cat("媒介中心性（betweenness centrality）
中央値　必須：",median(ess_nprop$between),"非必須：",median(noness_nprop$between),"\n")
wilcox.test(ess_nprop$between,noness_nprop$between)
cat("サブグラフ中心性（subgraph centrality）
中央値　必須：",median(ess_nprop$subgraph),"非必須：",median(noness_nprop$subgraph),"\n")
wilcox.test(ess_nprop$subgraph,noness_nprop$subgraph)
# 必須なら1，非必須なら0とする。
ess_score <- ifelse(d$essential == "E",1,0)
# ROCカーブを書くためのパッケージを読み込む
library(pROC)
layout(matrix(1:6, ncol=3))
# 次数中心性（degree centrality）
plot.roc(ess_score,d$degree,print.auc=T,main="Degree")
# 固有ベクトル中心性（eigenvector centraliry）
plot.roc(ess_score,d$eigen,print.auc=T,main="Eigenvector")
# PageRank
plot.roc(ess_score,d$page,print.auc=T,main="PageRank")
# 近接中心性（closeness centrality）
plot.roc(ess_score,d$closen,print.auc=T,main="Closeness")
# 媒介中心性（betweenness centrality）
plot.roc(ess_score,d$between,print.auc=T,main="Betweenness")
# サブグラフ中心性（Subgraph centrality）
plot.roc(ess_score,d$subgraph,print.auc=T,main="Subgraph")
